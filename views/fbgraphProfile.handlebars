{{> header}}
	<div class="container">
		<div class="row-fluid">
			<h3> Hello, {{userProfile.displayName}}! You are currently signed in as {{userProfile.username}} on {{userProfile.provider}}! </h3>
		</div>
		<div class="row-fluid">
			<div class="panel panel-default">
				<header class="panel-heading">
					<div class="container">
						<div class="col-lg-1">
							<img src="{{profPic}}" class="img-responsive img-circle">
						</div>
						<div class="col-lg-11">
							<h4>{{userProfile.displayName}} 
								<small>aka {{userProfile.username}}</small>
							</h4>
							<a href="/fbgraph/json">User JSON</a>
							<a href="/fbgraph/testAPI">Test API</a>
						</div>
					</div>
				</header>
				<div class="panel-body">
					<div class="col-lg-12">
						<div class="row">
							<h3> My Bio </h3>
							{{userProfile._json.bio}}
						</div>
						<div class="row">
							<h3> Let's Play a Game! </h3>
							<span>
								You will be shown a random photo you are tagged in.  Can you guess who posted it?
							</span>
							<br/>
							<form>
								<input name="randPic" id="randPic" type="hidden">
								<button class="btn btn-primary" id="randPicBtn" href="#">
									I accept your challenge!
								</button>
							</form>
						</div>
						<div class="row">
							<h3>Known Bugs</h3>
							<p> For some reason, the Facebook photo urls will only render as a 1px x 1px image. (If you don't believe me, check the source code!).</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- modal collection -->
		<div id="picResult" class="modal fade">
		  <div class="modal-dialog">
		    <div class="modal-content text-center">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		        <h4 id="Title" class="modal-title">Who posted this?</h4>
		      </div>
		      <div class="modal-body">
		      	<div class="row">
			      	</i><span>
			      		<a id="error" href="">If you don't see a picture, click here.  It will open in a new tab. </a>
			      	</span></i>
			    </div>
			    <div class="row">
			        <div id="pic-container">
			        	<!-- pic will display here -->
			        	<span id="load">Loading...</span>
			        	<img src="" class="img-responsive img-rounded">

					</div>
				</div>
				<br/>
				<div class="row">
					<span id="subtitle"></span>
				</div>
				<br/>
				<div class="row">
					<div class="input-group">
				      <input id="guess" type="text" class="form-control">
				      <span class="input-group-btn">
				        <button id="getGuess" class="btn btn-primary" type="button">Submit</button>
				      </span>
				    </div><!-- /input-group -->
				</div>

		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		      </div>
		    </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
{{> globaljs}}
	<script type="text/javascript">
		$(document).ready( function () {
			var solution = '';

			$('#randPicBtn').click(function (e) {

				e.preventDefault();

				$('#picResult').modal('show');

				// get a picture
				$.ajax({
					type: 'GET',
					url: '/fbgraph/randPic',
					dataType: 'json'
				}).done( function(response) {
					if (response.msg === '') {
						displayPic( response );
					} else {
						alert(response.msg);
					}
				});

				function displayPic( picJSON ) {
					// show the modal
					var picsource = '';
						picsource += picJSON.gameJSON.pic;

						solution += picJSON.gameJSON.solution;
						solution = solution.toLowerCase();

					var solutionArray = solution.split(' ');
						console.log(solutionArray);

					var img = '<img id="dapic" src="';
						img += picsource;
						img += '" class="img-responsive img-rounded">';

					var caption = picJSON.gameJSON.subtitle;

					$('#load').remove();
					$('#pic-container').append(img);
					$('#subtitle').text(caption);
					$('#error').attr('href', picsource);

					console.log(picJSON.gameJSON.solution);
				}
			});

			$('#error').click(function (e) {
				// let's hack something that works
				e.preventDefault();

				var picsource = $(this).attr('href');
				window.open(picsource);
			});
			
			$('#getGuess').click(function (e) {
				// get the guess from input
				var guess = $('#guess').val().toLowerCase();
				console.log(guess);
			})


		});
		
	</script>

{{> footer}}